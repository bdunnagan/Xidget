<script>
  <create assign="files" name="'files'"/>
  <assign name="files">
    $web/index.html |
    $web/Downloads.html |
    $web/XidgetOverview.html |
    $web/XidgetReference.html |
    $web/ScriptingOverview.html |
    $web/ScriptingReference.html |
    $web/About.html
  </assign>
  
  <create assign="nav">
    <template>
      <nav>
        <place title="Home" link="index.html"/>
        <place title="Download" link="Downloads.html"/>
        <place title="Xidget Overview" link="XidgetOverview.html"/>
        <place title="Xidget Reference" link="XidgetReference.html"/>
        <place title="Scripting Overview" link="ScriptingOverview.html"/>
        <place title="Scripting Reference" link="ScriptingReference.html"/>
        <place title="Aboute" link="About.html"/>
      </nav>
    </template>
  </create>
  
  <assign name="template">$web/HomeTemplate.html</assign>
  <!--assign name="menu">$web/navigation/HomeMenu.html/td</assign-->
  
  <for assign="file" source="$files">
    <assign name="built" mode="copy">$template</assign>

    <!-- compute build path -->    
    <assign name="path">replace( string( $file/@path), '\\', '/')</assign>
    <assign name="bpath">replace( $path, '^docs/web', 'docs/web/build')</assign>
    <assign name="bdir">replace( $bpath, '^(.*)/[^/]*[.]html$', '$1')</assign>
    <assign name="bname">replace( $bpath, '^.*/([^/]*[.]html)$', '$1')</assign>

    <!-- specify selected menuitem -->
    <delete>$nav/place/@selected</delete>
    <set source="'true'">$nav/place[ @link = $bname]/@selected</set>
    
    <!-- populate left pane -->
    <assign name="dst">$built/html//td[ @class="leftpane"]</assign>
    <invoke>$builder/createNavigation.xml/*</invoke>
    <!--
    <assign name="src">$menu</assign>
    <invoke>$builder/replaceHtml.xml/*</invoke> 
    -->
    
    <!-- populate right pane -->
    <assign name="src">$file/html/body</assign>
    <assign name="dst">$built/html//td[ @class="rightpane"]</assign>
    <invoke>$builder/replaceHtml.xml/*</invoke>
        
    <!-- fix links to point into build path -->
    <invoke context="$built">$builder/fixLinks.xml/*</invoke>
    
    <!-- make build directories -->
    <makeDir>$bdir</makeDir>
    
    <!-- save built html -->
    <fileSave mode="html" overwrite="true" source="$built" file="$bpath"/>
  </for>
</script>
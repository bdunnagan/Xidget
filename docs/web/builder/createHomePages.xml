<script>
  <create assign="files" name="'files'"/>
  <assign name="files">
    $web/index.html |
    $web/Downloads.html |
    $web/XidgetOverview.html |
    $web/XidgetReference.html |
    $web/ScriptingOverview.html |
    $web/ScriptingReference.html |
    $web/About.html
  </assign>
  
  <assign name="template">$web/HomeTemplate.html</assign>
  <assign name="menu">$web/navigation/HomeMenu.html/td</assign>
  
  <for assign="file" source="$files">
    <assign name="built" mode="copy">$template</assign>

    <!-- compute build path -->    
    <assign name="path">replace( string( $file/@path), '\\', '/')</assign>
    <assign name="bpath">replace( $path, '^docs/web', 'docs/web/build')</assign>
    <assign name="bdir">replace( $bpath, '^(.*)/[^/]*[.]html$', '$1')</assign>
    
    <!-- populate left pane -->
    <assign name="src">$menu</assign>
    <assign name="dst">$built/html//td[ @class="leftpane"]</assign>
    <invoke>$builder/replaceHtml.xml/*</invoke>
    
    <!-- populate right pane -->
    <assign name="src">$file/html/body</assign>
    <assign name="dst">$built/html//td[ @class="rightpane"]</assign>
    <invoke>$builder/replaceHtml.xml/*</invoke>
        
    <!-- fix links to point into build path -->
    <invoke context="$built">$builder/fixLinks.xml/*</invoke>
    
    <!-- make build directories -->
    <makeDir>$bdir</makeDir>
    
    <!-- save built html -->
    <fileSave mode="html" overwrite="true" source="$built" file="$bpath"/>
  </for>
</script>
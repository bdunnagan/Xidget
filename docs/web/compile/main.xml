<script>
  <create assign="compile">
    <template annotated="true">
      <html path="docs/web/compile">
        <extern:cache class="org.xmodel.external.caching.FileSystemCachingPolicy"/>
      </html>
    </template>
  </create>
  
  <create assign="html">
    <template annotated="true">
      <html path="docs/web">
        <extern:cache class="org.xmodel.external.caching.FileSystemCachingPolicy"/>
      </html>
    </template>
  </create>
  
  <create assign="files" name="'files'"/>
  
  <for assign="file" source="$html//*[ not( starts-with( name(), 'docs/web/unused')) and matches( name(), '.html$')]">
    <assign name="path">replace( string( $file/@path), '[\\]', '/')</assign>
    <assign name="rpath">concat( 'docs/build', replace( $path, '^docs/web(.*)', '$1'))</assign>
    <assign name="rdir">replace( $rpath, '^(.*)/[^/]+[.]html$', '$1')</assign>
    
    <!--makeDir when="starts-with( $rdir, 'docs\build')">$rdir</makeDir-->
    
    <print>$rpath</print>
    <assign name="files">$files | $file</assign>
  </for>
  
  <for source="$files">
    <invoke>$compile/include.xml/*</invoke>    
  </for>
</script>